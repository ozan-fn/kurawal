import{r as l,a as Y,t as se,X as ne,j as K,b as U,c as i,B as oe,R as F,u as ie,o as ae,d as le,L as A,x as H,$ as O,w as q,y as ce,U as ue,E as de,z as I,N as ge,e as me,O as fe,I as he,s as pe,i as be,f as we,g as xe,D as ye,h as Ee,k as ve,l as ze,n as Ce,C as Re,m as je,p as V}from"./index-BEOult1F.js";const Z=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],J=Z[Math.floor(Math.random()*Z.length)],Ne=l.createContext(null);function ke(){return{color:J[1],isCollabActive:!1,name:J[0],yjsDocMap:new Map}}ke();function De({initialEditor:n,children:z,initialNodes:h,initialTheme:j,skipCollabChecks:_,skipEditableListener:N}){const S=l.useRef(!1),y=l.useContext(Y);y==null&&(function(f,...k){const t=new URL("https://lexical.dev/docs/error"),x=new URLSearchParams;x.append("code",f);for(const a of k)x.append("v",a);throw t.search=x.toString(),Error(`Minified Lexical error #${f}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})(9);const[p,{getTheme:W}]=y,C=l.useMemo(()=>{const f=j||W()||void 0,k=se(y,f);f!==void 0&&(n._config.theme=f),n._parentEditor=n._parentEditor||p;const t=n._createEditorArgs,x=t&&t.namespace;if(h){x||(n._config.namespace=p._config.namespace);for(let a of h){let D=null,b=null;if(typeof a!="function"){const s=a;a=s.replace,D=s.with,b=s.withKlass||null}const e=ne(n,a.getType());n._nodes.set(a.getType(),{exportDOM:e?e.exportDOM:void 0,klass:a,replace:D,replaceWithKlass:b,sharedNodeState:U(a),transforms:K(a)})}}else if(t&&t.nodes)x||(n._config.namespace=p._config.namespace);else{const a=n._nodes=new Map(p._nodes);x||(n._config.namespace=p._config.namespace);for(const[D,b]of a)n._nodes.set(D,{exportDOM:b.exportDOM,klass:b.klass,replace:b.replace,replaceWithKlass:b.replaceWithKlass,sharedNodeState:U(b.klass),transforms:K(b.klass)})}return[n,k]},[]),L=l.useContext(Ne),{isCollabActive:d,yjsDocMap:E}=L??{},P=_||S.current||E&&E.has(n.getKey());return l.useEffect(()=>{P&&(S.current=!0)},[P]),l.useEffect(()=>{if(!N){const f=k=>n.setEditable(k);return f(p.isEditable()),p.registerEditableListener(f)}},[n,p,N]),i.jsx(Y.Provider,{value:C,children:!d||P?z:null})}function B(n,z,h){return Math.min(Math.max(n,z),h)}const o={east:1,north:8,south:2,west:4};function Me({onResizeStart:n,onResizeEnd:z,buttonRef:h,imageRef:j,maxWidth:_,editor:N,showCaption:S,setShowCaption:y,captionsEnabled:p}){const W=l.useRef(null),C=l.useRef({priority:"",value:"default"}),L=l.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),d=N.getRootElement(),E=_||(d!==null?d.getBoundingClientRect().width-20:100),P=d!==null?d.getBoundingClientRect().height-20:100,f=100,k=100,t=e=>{const s=e===o.east||e===o.west,r=e===o.north||e===o.south,R=e&o.north&&e&o.west||e&o.south&&e&o.east,w=s?"ew":r?"ns":R?"nwse":"nesw";d!==null&&d.style.setProperty("cursor",`${w}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${w}-resize`,"important"),C.current.value=document.body.style.getPropertyValue("-webkit-user-select"),C.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},x=()=>{d!==null&&d.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",C.current.value,C.current.priority))},a=(e,s)=>{if(!N.isEditable())return;const r=j.current,R=W.current;if(r!==null&&R!==null){e.preventDefault();const{width:w,height:v}=r.getBoundingClientRect(),c=F(r),u=L.current;u.startWidth=w,u.startHeight=v,u.ratio=w/v,u.currentWidth=w,u.currentHeight=v,u.startX=e.clientX/c,u.startY=e.clientY/c,u.isResizing=!0,u.direction=s,t(s),n(),R.classList.add("touch-action-none"),r.style.height=`${v}px`,r.style.width=`${w}px`,document.addEventListener("pointermove",D),document.addEventListener("pointerup",b)}},D=e=>{const s=j.current,r=L.current,R=r.direction&(o.east|o.west),w=r.direction&(o.south|o.north);if(s!==null&&r.isResizing){const v=F(s);if(R&&w){let c=Math.floor(r.startX-e.clientX/v);c=r.direction&o.east?-c:c;const u=B(r.startWidth+c,f,E),X=u/r.ratio;s.style.width=`${u}px`,s.style.height=`${X}px`,r.currentHeight=X,r.currentWidth=u}else if(w){let c=Math.floor(r.startY-e.clientY/v);c=r.direction&o.south?-c:c;const u=B(r.startHeight+c,k,P);s.style.height=`${u}px`,r.currentHeight=u}else{let c=Math.floor(r.startX-e.clientX/v);c=r.direction&o.east?-c:c;const u=B(r.startWidth+c,f,E);s.style.width=`${u}px`,r.currentWidth=u}}},b=()=>{const e=j.current,s=L.current,r=W.current;if(e!==null&&r!==null&&s.isResizing){const R=s.currentWidth,w=s.currentHeight;s.startWidth=0,s.startHeight=0,s.ratio=0,s.startX=0,s.startY=0,s.currentWidth=0,s.currentHeight=0,s.isResizing=!1,r.classList.remove("touch-action-none"),x(),z(R,w),document.removeEventListener("pointermove",D),document.removeEventListener("pointerup",b)}};return i.jsxs("div",{ref:W,children:[!S&&p&&i.jsx(oe,{className:"image-caption-button absolute bottom-1 left-1/2 -translate-x-1/2",ref:h,variant:"outline",onClick:()=>{y(!S)},children:"Add Caption"}),i.jsx("div",{className:"image-resizer image-resizer-n bg-primary absolute -top-2.5 left-1/2 h-2 w-2 -translate-x-1/2 cursor-ns-resize",onPointerDown:e=>{a(e,o.north)}}),i.jsx("div",{className:"image-resizer image-resizer-ne bg-primary absolute -top-2.5 -right-2.5 h-2 w-2 cursor-nesw-resize",onPointerDown:e=>{a(e,o.north|o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-e bg-primary absolute top-1/2 -right-2.5 h-2 w-2 -translate-y-1/2 cursor-ew-resize",onPointerDown:e=>{a(e,o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-se bg-primary absolute -right-2.5 -bottom-2.5 h-2 w-2 cursor-nwse-resize",onPointerDown:e=>{a(e,o.south|o.east)}}),i.jsx("div",{className:"image-resizer image-resizer-s bg-primary absolute -bottom-2.5 left-1/2 h-2 w-2 -translate-x-1/2 cursor-ns-resize",onPointerDown:e=>{a(e,o.south)}}),i.jsx("div",{className:"image-resizer image-resizer-sw bg-primary absolute -bottom-2.5 -left-2.5 h-2 w-2 cursor-nesw-resize",onPointerDown:e=>{a(e,o.south|o.west)}}),i.jsx("div",{className:"image-resizer image-resizer-w bg-primary absolute top-1/2 -left-2.5 h-2 w-2 -translate-y-1/2 cursor-ew-resize",onPointerDown:e=>{a(e,o.west)}}),i.jsx("div",{className:"image-resizer image-resizer-nw bg-primary absolute -top-2.5 -left-2.5 h-2 w-2 cursor-nwse-resize",onPointerDown:e=>{a(e,o.north|o.west)}})]})}const T=new Set,Q=je("RIGHT_CLICK_IMAGE_COMMAND");function Se(n){if(!T.has(n))throw new Promise(z=>{const h=new Image;h.src=n,h.onload=()=>{T.add(n),z(null)},h.onerror=()=>{T.add(n)}})}function Le({altText:n,className:z,imageRef:h,src:j,width:_,height:N,maxWidth:S,onError:y}){return Se(j),i.jsx("img",{className:z||void 0,src:j,alt:n,ref:h,style:{height:N,maxWidth:S,width:_},onError:y,draggable:"false"})}function Pe(){return i.jsx("img",{src:"",style:{height:200,opacity:.2,width:200},draggable:"false"})}function $e({src:n,altText:z,nodeKey:h,width:j,height:_,maxWidth:N,resizable:S,showCaption:y,caption:p,captionsEnabled:W}){const C=l.useRef(null),L=l.useRef(null),[d,E,P]=ie(h),[f,k]=l.useState(!1),[t]=ae(),[x,a]=l.useState(null),D=l.useRef(null),[b,e]=l.useState(!1),s=le(),r=l.useCallback(g=>{const m=A();return d&&H(m)&&(g.preventDefault(),t.update(()=>{m.getNodes().forEach($=>{O($)&&$.remove()})})),!1},[t,d]),R=l.useCallback(g=>{const m=A(),M=L.current;if(d&&H(m)&&m.getNodes().length===1){if(y)return q(null),g.preventDefault(),p.focus(),!0;if(M!==null&&M!==document.activeElement)return g.preventDefault(),M.focus(),!0}return!1},[p,d,y]),w=l.useCallback(g=>D.current===p||L.current===g.target?(q(null),t.update(()=>{E(!0);const m=t.getRootElement();m!==null&&m.focus()}),!0):!1,[p,t,E]),v=l.useCallback(g=>{const m=g;return f?!0:m.target===C.current?(m.shiftKey?E(!d):(P(),E(!0)),!0):!1},[f,d,E,P]),c=l.useCallback(g=>{t.getEditorState().read(()=>{const m=A();g.target.tagName==="IMG"&&ce(m)&&m.getNodes().length===1&&t.dispatchCommand(Q,g)})},[t]);l.useEffect(()=>{let g=!0;const m=t.getRootElement(),M=ue(t.registerUpdateListener(({editorState:$})=>{g&&a($.read(()=>A()))}),t.registerCommand(be,($,re)=>(D.current=re,!1),I),t.registerCommand(pe,v,I),t.registerCommand(Q,v,I),t.registerCommand(he,$=>$.target===C.current?($.preventDefault(),!0):!1,I),t.registerCommand(fe,r,I),t.registerCommand(me,r,I),t.registerCommand(ge,R,I),t.registerCommand(de,w,I));return m?.addEventListener("contextmenu",c),()=>{g=!1,M(),m?.removeEventListener("contextmenu",c)}},[P,t,f,d,h,r,R,w,v,c,E]);const u=()=>{t.update(()=>{const g=V(h);O(g)&&g.setShowCaption(!0)})},X=(g,m)=>{setTimeout(()=>{k(!1)},200),t.update(()=>{const M=V(h);O(M)&&M.setWidthAndHeight(g,m)})},ee=()=>{k(!0)},te=d&&H(x)&&!f,G=(d||f)&&s;return i.jsx(l.Suspense,{fallback:null,children:i.jsxs(i.Fragment,{children:[i.jsx("div",{draggable:te,children:b?i.jsx(Pe,{}):i.jsx(Le,{className:`max-w-full cursor-default ${G?`${H(x)?"draggable cursor-grab active:cursor-grabbing":""} focused ring-primary ring-2 ring-offset-2`:null}`,src:n,altText:z,imageRef:C,width:j,height:_,maxWidth:N,onError:()=>e(!0)})}),y&&i.jsx("div",{className:"image-caption-container absolute right-0 bottom-1 left-0 m-0 block min-w-[100px] overflow-hidden border-t bg-white/90 p-0",children:i.jsxs(De,{initialEditor:p,initialNodes:[we,xe,ye],children:[i.jsx(Ee,{}),i.jsx(ve,{}),i.jsx(ze,{contentEditable:i.jsx(Re,{className:"ImageNode__contentEditable user-select-text word-break-break-word caret-primary relative block min-h-5 w-[calc(100%-20px)] cursor-text resize-none border-0 p-2.5 text-sm whitespace-pre-wrap outline-none",placeholderClassName:"ImageNode__placeholder text-sm text-muted-foreground overflow-hidden absolute top-2.5 left-2.5 pointer-events-none text-ellipsis user-select-none whitespace-nowrap inline-block",placeholder:"Enter a caption..."}),ErrorBoundary:Ce})]})}),S&&H(x)&&G&&i.jsx(Me,{showCaption:y,setShowCaption:u,editor:t,buttonRef:L,imageRef:C,maxWidth:N,onResizeStart:ee,onResizeEnd:X,captionsEnabled:!b&&W})]})})}export{Q as RIGHT_CLICK_IMAGE_COMMAND,$e as default};
